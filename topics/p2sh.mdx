---
title: "P2SH - Pay To Script Hash (BIP 16)"
date: 2024-01-25T15:32:14Z
lastmod: "2024-07-26"
draft: false
category: Scripts
layout: PostSimple
children: ["p2sh-exercise"]
order: 8
---

This was the first transaction to use P2SH:
[a0f1aaa2fb4582c89e0511df0374a5a2833bf95f7314f4a51b55b7b71e90ce0f](https://mempool.space/tx/a0f1aaa2fb4582c89e0511df0374a5a2833bf95f7314f4a51b55b7b71e90ce0f)

Let's examine this transaction from start to finish as will help us understand P2SH better.

P2SH enables more complex spending conditions. Instead of sending bitcoins to a public key hash (P2PKH) or public key (P2PK) as we saw in previous topics, **P2SH allows you to send funds to the hash of a script**

You can use any custom locking script you want. The most common standard script is **MultiSig** (which we'll explain in this example).

<ExpandableAlert
  title="NOTE"
  type="info"
>
Since Bitcoin Core release 0.10.0, the **IsStandard()** rules have been removed for P2SH, allowing you to use any custom locking script.

An example of a non-standard locking script is [Peter Todd's hash-collision challenge](https://bitcointalk.org/index.php?topic=293382.0).

</ExpandableAlert>

To help illustrate this, let's introduce Alice and Bob.

### Creating Redeem Script

The first step is creating the redeem script.

A redeem script is a Bitcoin script that defines the conditions under which funds can be spent. It's called a "redeem" script because it's used at redemption time (spending) rather than as a locking script.

Alice and Bob want to create a 2-of-2 multisig address. Their redeem script looks like this:

```
2
<public key Alice>
<public key Bob>
2
OP_CHECKMULTISIG
```

This means both Alice's and Bob's signatures are required to spend the funds.

### Locking Script

Now it's time to lock the funds into this script.  
The scriptPubKey for the P2SH looks like this:

```
OP_HASH160 <20-byte hash of redeem script> OP_EQUAL
```

As you can see, we still have to hash the redeem script we created before:

1. Apply SHA-256 to the redeem script
2. Apply RIPEMD-160 to the SHA-256 hash

This will produce a 20-byte hash:

```
<20-byte hash of redeem script>
```

This is the hash we use to lock the funds.

click on output 1 of this Transaction to see it in action.

<TransactionsDisplay
    rawTx="01000000014ce7153d92e3b24d9eea31f8cf391c3fb4c39f7742b341b2d36c6367e7546474000000006c493046022100c554360535b2ad3b1cb1b966a87807f7a7e45fa485348d662a1e7413dced8471022100d6bcfc4385b7ac41ca3968a73c4a28e38879192c3db1286b36e59ec9fce52bbd012103c96e3a9e63986801269d5f278246ed7cdc2d392595d0a25b102e04598f4b4fa9ffffffff02cb871a00000000001976a914c02ebae82202119f23f330781ff26b303edb7dbd88ac809698000000000017a914748284390f9e263a4b766a75d0633c50426eb8758700000000"
    txId="a0f1aaa2fb4582c89e0511df0374a5a2833bf95f7314f4a51b55b7b71e90ce0f"
    txTitle="First P2SH transaction"
    highlightIndex={{ outputs: 1 }}
/>

### ScriptSig

When either Alice or Bob wants to spend the funds, they must provide the redeem script and signatures that satisfy the redeem script. The scriptSig for P2SH looks like this:

```
<Alice's signature> <Bob's signature> <redeem script>
```

Click on input 1 to see this in action

<TransactionsDisplay
    rawTx="0100000003a5ee1a0fd80dfbc3142df136ab56e082b799c13aa977c048bdf8f61bd158652c000000006b48304502203b0160de302cded63589a88214fe499a25aa1d86a2ea09129945cd632476a12c022100c77727daf0718307e184d55df620510cf96d4b5814ae3258519c0482c1ca82fa0121024f4102c1f1cf662bf99f2b034eb03edd4e6c96793cb9445ff519aab580649120ffffffff0fce901eb7b7551ba5f414735ff93b83a2a57403df11059ec88245fba2aaf1a0000000006a47304402204089adb8a1de1a9e22aa43b94d54f1e54dc9bea745d57df1a633e03dd9ede3c2022037d1e53e911ed7212186028f2e085f70524930e22eb6184af090ba4ab779a5b90121030644cb394bf381dbec91680bdf1be1986ad93cfb35603697353199fb285a119effffffff0fce901eb7b7551ba5f414735ff93b83a2a57403df11059ec88245fba2aaf1a0010000009300493046022100a07b2821f96658c938fa9c68950af0e69f3b2ce5f8258b3a6ad254d4bc73e11e022100e82fab8df3f7e7a28e91b3609f91e8ebf663af3a4dc2fd2abd954301a5da67e701475121022afc20bf379bc96a2f4e9e63ffceb8652b2b6a097f63fbee6ecec2a49a48010e2103a767c7221e9f15f870f1ad9311f5ab937d79fcaeee15bb2c722bca515581b4c052aeffffffff02a3b81b00000000001976a914ea00917f128f569cbdf79da5efcd9001671ab52c88ac80969800000000001976a9143dec0ead289be1afa8da127a7dbdd425a05e25f688ac00000000"
    txId="4d8eabfc8e6c266fb0ccd815d37dd69246da634df0effd5a5c922e4ec37880f6"
    highlightIndex={{ inputs: 2 }}
/>

## Address :

The P2SH locking script pattern has been assigned its own address.

## <P2SHEncoder initialScriptHash="9ded082e689c0d409cae7e414983a1fc528fd61f" />

### Mini Exercise: Find the Script Hash

In this exercise, you'll find a script hash within a transaction and use it to calculate the related Bitcoin address.

1. Find the 20-byte hash of the redeem script from the transaction we discussed in this lesson.

2. Enter the script hash into the tool above to find the corresponding Bitcoin address.

3. **Verify Your Result:** The address you should get is: `3CK4fEwbMP7heJarmU4eqA3sMbVJyEnU3V`

Feel free to refer back to the article if you need a refresher on how P2SH works. Good luck!
